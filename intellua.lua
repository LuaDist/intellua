local oldrequire = require
local dist = require "dist"
local modules

local newrequire = function(mod)
	local ok, res = pcall(oldrequire, mod)
	if ok then
		return res
	else
		local where = modules[mod]
		if type(where) == "string" then
			dist.install(where)
		else
			io.write('The module "', mod, '" is provided by the following packages: ')
			for i,m in ipairs(where) do
				io.write(m, ' ')
			end
			io.write('\nChoose package to install: ')
			local choice = io.read()
			assert(dist.install(choice))
		end
		return oldrequire(mod)
	end
end

modules = {
  md4 = "lmd5",
  md5 = "lmd5",
  sha1 = "lmd5",
  sha224 = "lmd5",
  sha256 = "lmd5",
  sha384 = "lmd5",
  sha512 = "lmd5",
  ripemd160 = "lmd5",
  Coat = "lua-coat",
  ["Coat.Meta.Class"] = "lua-coat",
  ["Coat.Meta.Role"] = "lua-coat",
  ["Coat.Persistent"] = "lua-coatpersistent",
  ["Coat.Role"] = "lua-coat",
  ["Coat.Types"] = "lua-coat",
  ["Coat.UML"] = "lua-coat",
  ["Coat.file"] = "lua-coat",
  CodeGen = "lua-codegen",
  ["CodeGen.Graph"] = "lua-codegen",
  ["CodeGen.lpeg"] = "lua-codegen",
  LuaXml = "luaxml",
  Spore = "lua-spore",
  ["Spore.Core"] = "lua-spore",
  ["Spore.GoogleDiscovery"] = "lua-spore",
  ["Spore.Middleware.Auth.AWS"] = "lua-spore",
  ["Spore.Middleware.Auth.Basic"] = "lua-spore",
  ["Spore.Middleware.Auth.Bearer"] = "lua-spore",
  ["Spore.Middleware.Auth.Digest"] = { "lua-spore", "lua-spore" },
  ["Spore.Middleware.Auth.OAuth"] = "lua-spore",
  ["Spore.Middleware.Cache"] = "lua-spore",
  ["Spore.Middleware.DoNotTrack"] = "lua-spore",
  ["Spore.Middleware.Format.JSON"] = "lua-spore",
  ["Spore.Middleware.Format.XML"] = "lua-spore",
  ["Spore.Middleware.Format.YAML"] = "lua-spore",
  ["Spore.Middleware.Logging"] = "lua-spore",
  ["Spore.Middleware.Mock"] = "lua-spore",
  ["Spore.Middleware.Parameter.Default"] = "lua-spore",
  ["Spore.Middleware.Parameter.Force"] = "lua-spore",
  ["Spore.Middleware.Proxy.Basic"] = "lua-spore",
  ["Spore.Middleware.Redirection"] = "lua-spore",
  ["Spore.Middleware.Runtime"] = "lua-spore",
  ["Spore.Middleware.UserAgent"] = "lua-spore",
  ["Spore.Protocols"] = "lua-spore",
  ["Spore.Request"] = "lua-spore",
  ["Test.Builder"] = "lua-testmore",
  ["Test.Builder.SocketOutput"] = "lua-testmore",
  ["Test.Builder.Tester"] = "lua-testmore",
  ["Test.Builder.Tester.File"] = "lua-testmore",
  ["Test.LongString"] = "lua-testlongstring",
  ["Test.More"] = "lua-testmore",
  alarm = "lalarm",
  alien = "alien",
  ["alien.core"] = "alien",
  ["alien.struct"] = "alien",
  alt_getopt = "alt-getopt",
  apr = { "apr", "lua-apr" },
  ["apr.core"] = "lua-apr",
  ["apr.serialize"] = "lua-apr",
  ascii85 = "lascii85",
  base = "lua-stdlib",
  base64 = "lbase64",
  bc = "lbc",
  bci = "lbci",
  bin = "lua-stdlib",
  ["bin.gunziplua"] = "lua-compress-deflatelua",
  binomial = "simulua",
  bit = { "bitlib", "luabitop" },
  ["bit.numberlua"] = "lua-bit-numberlua",
  bsd = "libbsd",
  bz2 = "bzip2",
  cURL = "lua-curl",
  cd = "cd",
  cdb = "lua-tinycdb",
  cdf = "simulua",
  cdgdk = "cd",
  cdlua = "cd",
  cdlua_module = "cd",
  cdluacairo = "cd",
  cdluacontextplus = { "cd", "cd" },
  cdluagl = "cd",
  cdluaim = "cd",
  cdluapdf = "cd",
  cdx11 = "cd",
  cgilua = "cgilua",
  ["cgilua.authentication"] = "cgilua",
  ["cgilua.cookies"] = "cgilua",
  ["cgilua.dispatcher"] = "cgilua",
  ["cgilua.loader"] = "cgilua",
  ["cgilua.lp"] = "cgilua",
  ["cgilua.mime"] = "cgilua",
  ["cgilua.post"] = "cgilua",
  ["cgilua.readuntil"] = "cgilua",
  ["cgilua.serialize"] = "cgilua",
  ["cgilua.session"] = "cgilua",
  ["cgilua.urlcode"] = "cgilua",
  cheese = "cheese",
  ["cheese.luap"] = "cheese",
  ["cheese.luap.dump"] = "cheese",
  ["cheese.parsers"] = "cheese",
  ciostring = "lazykit",
  cjson = "lua-cjson",
  classlib = "classlib",
  cldaemon = "concurrentlua",
  cltime = "concurrentlua",
  colors = "lua-colors",
  complex = { "lcomplex", "lua-matrix" },
  ["compress.deflatelua"] = "lua-compress-deflatelua",
  ["concatxmlgen.lua"] = "lazykit",
  config = "config",
  contractor = "luacontractor",
  controller = "remdebug",
  copas = "copas",
  core = "luagraph",
  cosmo = "cosmo",
  ["cosmo.fill"] = "cosmo",
  ["cosmo.grammar"] = "cosmo",
  coxpcall = "coxpcall",
  crypto = { "luacrypto", "slncrypto" },
  curses = "luaposix",
  curses_c = "luaposix",
  dado = "dado",
  ["dado.object"] = "dado",
  ["dado.sql"] = "dado",
  date = "luadate",
  debug_ext = "lua-stdlib",
  debug_init = "lua-stdlib",
  des56 = "md5",
  diff = "diff",
  ["digest.crc32lua"] = "lua-digest-crc32lua",
  diluculum = "diluculum",
  discount = "lua-discount",
  ["dist.config"] = "luadist-git",
  ["dist.constraints"] = "luadist-git",
  ["dist.depends"] = "luadist-git",
  ["dist.git"] = "luadist-git",
  ["dist.init"] = "luadist-git",
  ["dist.manifest"] = "luadist-git",
  ["dist.package"] = "luadist-git",
  ["dist.sys"] = "luadist-git",
  ["dist.utils"] = "luadist-git",
  epeg = "epeg",
  etree = "etree",
  ex = "luaex",
  expat = "libexpat",
  fcgi = "fcgi",
  ffi = { "luaffi", "libffi" },
  freeglut = "freeglut",
  freetype = "freetype",
  fstable = "lua-stdlib",
  gd = "luagd",
  gdbm = { "lgdbm", "libgdbm" },
  genx = "genx",
  genx_lib = "genx",
  getopt = { "lua-stdlib", "getopt" },
  git = "lua-git",
  ["git.core"] = "lua-git",
  ["git.objects"] = "lua-git",
  ["git.pack"] = "lua-git",
  ["git.protocol"] = "lua-git",
  ["git.repo"] = "lua-git",
  ["git.util"] = "lua-git",
  glew = "glew",
  gpc = { "lgpc", "gpc" },
  graph = "luagraph",
  gsl = { "gsl", "gslshell" },
  gzio = "gzio",
  gzip = "lzlib",
  hiredis = "lua-hiredis",
  http = "luasoap",
  iconv = { "lua-iconv", "libiconv" },
  igsl = "gslshell",
  il = "libdevil",
  ilu = "libdevil",
  ilut = "libdevil",
  im = "im",
  im_avi = "im",
  im_capture = "im",
  im_ecw = "im",
  im_process_omp = "im",
  im_wmv = "im",
  imlua = "im",
  imlua_avi = "im",
  imlua_capture = "im",
  imlua_fftw = "im",
  imlua_jp2 = "im",
  imlua_module = "im",
  imlua_process = "im",
  imlua_process_omp = "im",
  imlua_wmv = "im",
  integ = "gslshell",
  io_ext = "lua-stdlib",
  iostring = "lazykit",
  ioxmlgen = "lazykit",
  iup = "iup",
  iup_mglplot = "iup",
  iup_pplot = "iup",
  iupcd = "iup",
  iupcdaux = "cd-examples",
  iupcontrols = "iup",
  iupgl = "iup",
  iupgtk = "iup",
  iupim = "iup",
  iupimglib = "iup",
  iuplua = "iup",
  iuplua_mglplot = "iup",
  iuplua_module = "iup",
  iuplua_pplot = "iup",
  iupluacd = "iup",
  iupluacontrols = "iup",
  iupluagl = "iup",
  iupluaim = "iup",
  iupluaimglib = "iup",
  iupluaole51 = "iup",
  iupluatuio = "iup",
  iupluaweb = "iup",
  iupmotif = "iup",
  iupole = "iup",
  iuptuio = "iup",
  iupweb = { "iup", "iup" },
  iupx = "iup-examples",
  iupxpplot = "iup-examples",
  jpeg = "libjpeg",
  kepler_init = "kepler",
  lanes = "lanes",
  ["lanes-keeper"] = "lanes",
  ["lanes.core"] = "lanes",
  lazytree = "lazykit",
  lcms = "lcms",
  lcms2 = "lcms2",
  lcs = "lua-stdlib",
  leg = "leg",
  ["leg.grammar"] = "leg",
  ["leg.parser"] = "leg",
  ["leg.scanner"] = "leg",
  lemock = "lemock",
  lfcgi = "wsapi",
  lfs = "luafilesystem",
  liblua = { "lua", "luajit", "lualnum" },
  libninja = "ninja",
  libtcc = "tcc",
  libusb = "lualibusb",
  libwxlua = "wxlua",
  lip = "lip",
  list = "lua-stdlib",
  llex = "luasrcdiet",
  lmock = "lmock",
  logging = "lualogging",
  ["logging.console"] = "lualogging",
  ["logging.email"] = "lualogging",
  ["logging.file"] = "lualogging",
  ["logging.rolling_file"] = "lualogging",
  ["logging.socket"] = "lualogging",
  ["logging.sql"] = "lualogging",
  lparser = "luasrcdiet",
  lpc = "lpc",
  lpeg = "lpeg",
  lsqlite3 = "lsqlite3",
  ltn12 = "luasocket",
  luaXML_lib = "luaxml",
  luabind = "luabind",
  luacom = "luacom",
  luacov = "luacov",
  ["luacov.stats"] = "luacov",
  ["luacov.tick"] = "luacov",
  luacurl = "luacurl",
  luagl = { "luagl", "luaglut" },
  luaglu = "luagl",
  luaglut = "luaglut",
  luaidl = "luaidl",
  ["luaidl.lex"] = "luaidl",
  ["luaidl.pre"] = "luaidl",
  ["luaidl.sin"] = "luaidl",
  luajava = "luajava",
  luars232 = "librs232",
  ["luasql.firebird"] = "luasql-firebird",
  ["luasql.mysql"] = "luasql-mysql",
  ["luasql.odbc"] = "luasql-odbc",
  ["luasql.postgres"] = "luasql-postgresql",
  ["luasql.sqlite"] = "luasql-sqlite",
  ["luasql.sqlite3"] = "luasql-sqlite3",
  luaunit = { "lmock", "luaunit" },
  luma = "luma",
  ["luma.cosmo"] = "luma",
  ["luma.re"] = "luma",
  lunit = "lunit",
  ["lunit-console"] = "lunit",
  ["lunit-tests"] = "lunit",
  lxp = "luaexpat",
  ["lxp.lom"] = "luaexpat",
  lxpevent = "lazykit",
  lxptree = "lazykit",
  mapm = { "lmapm", "mapm" },
  markdown = "markdown",
  math_ext = "lua-stdlib",
  mathx = "lmathx",
  matrix = "lua-matrix",
  mbox = "lua-stdlib",
  md5 = "md5",
  ["md5.core"] = "md5",
  memarray = "luaglut",
  memoryfile = "lua-memoryfile",
  mime = "luasocket",
  ["mime.core"] = "luasocket",
  mixlua = "mixlua",
  mk = "mk",
  ["mk.auth"] = "mk",
  ["mk.blocks"] = "mk",
  ["mk.cache"] = "mk",
  ["mk.forms"] = "mk",
  ["mk.routes"] = "mk",
  ["mk.template"] = "mk",
  ["mk.themes"] = "mk",
  ["mk.util"] = "mk",
  mng = "libmng",
  mock_env = "lmock",
  mock_invoker = "lmock",
  mock_method = "lmock",
  modules = "lua-stdlib",
  moon = "moonscript",
  ["moon.all"] = "moonscript",
  moonscript = "moonscript",
  ["moonscript.compile"] = "moonscript",
  ["moonscript.compile.format"] = "moonscript",
  ["moonscript.compile.statement"] = "moonscript",
  ["moonscript.compile.value"] = "moonscript",
  ["moonscript.data"] = "moonscript",
  ["moonscript.dump"] = "moonscript",
  ["moonscript.errors"] = "moonscript",
  ["moonscript.parse"] = "moonscript",
  ["moonscript.transform"] = "moonscript",
  ["moonscript.types"] = "moonscript",
  ["moonscript.util"] = "moonscript",
  ["moonscript.version"] = "moonscript",
  motif = "luamotif",
  numlua = "numlua",
  ["objc.BridgeSupport"] = "tlc",
  ["objc.init"] = "tlc",
  object = "lua-stdlib",
  ["objectlua.Class"] = "objectlua",
  ["objectlua.Object"] = "objectlua",
  ["objectlua.Prototype"] = "objectlua",
  ["objectlua.bootstrap"] = "objectlua",
  onig = "onig",
  openssl = "lua-openssl",
  optlex = "luasrcdiet",
  optparser = "luasrcdiet",
  ["orbit.cache"] = "orbit",
  ["orbit.model"] = "orbit",
  ["orbit.ophandler"] = "orbit",
  ["orbit.pages"] = "orbit",
  ["orbit.routes"] = "orbit",
  pack = "lpack",
  package_ext = "lua-stdlib",
  parser = "lua-stdlib",
  pcre = "pcre",
  pcrecpp = "pcre",
  pgsql = "luapgsql",
  pithreads = "luapi",
  ["plugin.example"] = "luasrcdiet",
  ["plugin.html"] = "luasrcdiet",
  ["plugin.sloc"] = "luasrcdiet",
  pluto = "pluto",
  pod = "luapod",
  posix = "luaposix",
  posix_c = "luaposix",
  pq = "libpq",
  profiler = "luaprofiler",
  ["pythonic.optparse"] = "lua-pythonic-optparse",
  qtlua = "qtlua",
  queue = "simulua",
  random = "lrandom",
  re = "lpeg",
  recaptcha = "recaptcha",
  record = "luanativeobjects",
  ["remdebug.engine"] = "remdebug",
  rex_gnu = "lrexlib-gnu",
  rex_onig = "lrexlib-oniguruma",
  rex_pcre = "lrexlib-pcre",
  rex_posix = { "lrexlib-tre", "lrexlib-posix" },
  rings = "rings",
  rng = "simulua",
  rs232 = "librs232",
  rxspencer = "regex",
  saci = "saci",
  sajax = "xavante",
  scintilla = "scintilla",
  set = "lua-stdlib",
  shake = "shake",
  ["shake.stir"] = "shake",
  signal = "lua-signal",
  simulua = "simulua",
  soap = "luasoap",
  socket = "luasocket",
  ["socket.core"] = "luasocket",
  ["socket.ftp"] = "luasocket",
  ["socket.headers"] = "luasocket",
  ["socket.http"] = "luasocket",
  ["socket.smtp"] = "luasocket",
  ["socket.tp"] = "luasocket",
  ["socket.url"] = "luasocket",
  sool = "sool",
  sqlite3 = "libsqlite3",
  ssl = "luasec",
  ["ssl.context"] = "luasec",
  ["ssl.https"] = "luasec",
  stable = { "venv", "rings" },
  stack = "simulua",
  std = "lua-stdlib",
  strbuf = "lua-stdlib",
  ["stream.file"] = "cheese",
  ["stream.string"] = "cheese",
  strict = { "lua-stdlib", "lua", "lualnum", "lpeg" },
  string_ext = "lua-stdlib",
  sys = "luasys",
  ["table.extra"] = "dado",
  table_ext = "lua-stdlib",
  tar = "gzio",
  task = "luatask",
  testing_thread = "luasocket",
  tiff = "libtiff",
  tokyocabinet = { "lua-tokyocabinet", "tokyocabinet" },
  toluapp_lib = "toluapp",
  tre = "tre",
  tree = "lua-stdlib",
  unclasslib = "classlib",
  unicode = "slnunicode",
  uri = "lua-uri",
  utils = "luapi",
  uuid = "luuid",
  v3 = "lv3",
  venv = "venv",
  ["versium.errors"] = "versium",
  ["versium.filedir"] = "versium",
  ["versium.util"] = "versium",
  ["versium.virtual"] = "versium",
  view_image = "im-examples",
  vstruct = "vstruct",
  ["vstruct.ast"] = "vstruct",
  ["vstruct.ast.Bitpack"] = "vstruct",
  ["vstruct.ast.Generator"] = "vstruct",
  ["vstruct.ast.IO"] = "vstruct",
  ["vstruct.ast.List"] = "vstruct",
  ["vstruct.ast.Name"] = "vstruct",
  ["vstruct.ast.Repeat"] = "vstruct",
  ["vstruct.ast.Root"] = "vstruct",
  ["vstruct.ast.Table"] = "vstruct",
  ["vstruct.cursor"] = "vstruct",
  ["vstruct.io"] = "vstruct",
  ["vstruct.io.a"] = "vstruct",
  ["vstruct.io.b"] = "vstruct",
  ["vstruct.io.bigendian"] = "vstruct",
  ["vstruct.io.c"] = "vstruct",
  ["vstruct.io.defaults"] = "vstruct",
  ["vstruct.io.endianness"] = "vstruct",
  ["vstruct.io.f"] = "vstruct",
  ["vstruct.io.hostendian"] = "vstruct",
  ["vstruct.io.i"] = "vstruct",
  ["vstruct.io.littleendian"] = "vstruct",
  ["vstruct.io.m"] = "vstruct",
  ["vstruct.io.p"] = "vstruct",
  ["vstruct.io.s"] = "vstruct",
  ["vstruct.io.seekb"] = "vstruct",
  ["vstruct.io.seekf"] = "vstruct",
  ["vstruct.io.seekto"] = "vstruct",
  ["vstruct.io.u"] = "vstruct",
  ["vstruct.io.x"] = "vstruct",
  ["vstruct.io.z"] = "vstruct",
  ["vstruct.lexer"] = "vstruct",
  ["vstruct.pack"] = "vstruct",
  ["vstruct.test"] = "vstruct",
  ["vstruct.test.basic"] = "vstruct",
  ["vstruct.test.common"] = "vstruct",
  ["vstruct.test.fp-bigendian"] = "vstruct",
  ["vstruct.test.fp-littleendian"] = "vstruct",
  ["vstruct.test.struct-test-gen"] = "vstruct",
  ["vstruct.unpack"] = "vstruct",
  ["wsapi.basic_auth"] = "wsapi_basic_auth",
  ["wsapi.cgi"] = "wsapi",
  ["wsapi.common"] = "wsapi",
  ["wsapi.fastcgi"] = "wsapi",
  ["wsapi.request"] = "wsapi",
  ["wsapi.response"] = "wsapi",
  ["wsapi.ringer"] = "wsapi",
  ["wsapi.sapi"] = "wsapi",
  ["wsapi.util"] = "wsapi",
  ["wsapi.xavante"] = "wsapi",
  wx = { "wxwidgets", "wxlua" },
  wx_gl = "wxwidgets",
  wx_stc = "wxwidgets",
  xavante = "xavante",
  ["xavante.cgiluahandler"] = "xavante",
  ["xavante.encoding"] = "xavante",
  ["xavante.filehandler"] = "xavante",
  ["xavante.httpd"] = "xavante",
  ["xavante.indexhandler"] = "xavante",
  ["xavante.mime"] = "xavante",
  ["xavante.patternhandler"] = "xavante",
  ["xavante.redirecthandler"] = "xavante",
  ["xavante.ruleshandler"] = "xavante",
  ["xavante.urlhandler"] = "xavante",
  ["xavante.vhostshandler"] = "xavante",
  xml = "lua-stdlib",
  xmlgen = "lazykit",
  xmliter = "lazykit",
  xmlreader = "lua-xmlreader",
  ["xmlrpc.http"] = "lua-xmlrpc",
  ["xmlrpc.init"] = "lua-xmlrpc",
  ["xmlrpc.server"] = "lua-xmlrpc",
  xmlview = "lazykit",
  xssfilter = "xssfilter",
  xstring = "xstring",
  zip = "luazip",
  zlib = { "zlib", "lzlib" },
  zmq = { "lua-zmq", "libzmq" },
  ["zmq.poller"] = "lua-zmq",
  ["zmq.threads"] = "lua-zmq",
  zziplib = "libzzip"
}

return newrequire
